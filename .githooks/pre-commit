#!/usr/bin/env bash
# Pre-commit hook: enforce fmt and clippy before commit
# Skip if SKIP_HOOKS=1 is set

set -e

if [ "${SKIP_HOOKS:-0}" = "1" ]; then
    echo "Skipping pre-commit hooks (SKIP_HOOKS=1)"
    exit 0
fi

# Try to use cargo directly, fall back to nix develop
if command -v cargo &> /dev/null; then
    CARGO="cargo"
else
    CARGO="nix develop -c cargo"
fi

echo "Running cargo fmt check..."
$CARGO fmt --all -- --check

echo "Running cargo clippy..."
$CARGO clippy -- -D warnings
$CARGO clippy --features telemetry -- -D warnings
$CARGO clippy --features nif -- -D warnings

echo "All checks passed!"
